<!-- 常见病预测模块 -->
<div class="disease-prediction-container">
    <!-- 模块标题区域 -->
    <div class="module-header">
        <div class="header-icon">
            <i class="fas fa-heartbeat"></i>
        </div>
        <div class="header-content">
            <h3 class="module-title">常见病预测分析</h3>
            <p class="module-subtitle">基于微生物组数据的多疾病风险预测</p>
        </div>
    </div>

    <!-- 样本选择区域 -->
    <div class="sample-selection-section">
        <div class="selection-card">
            <div class="card-icon">
                <i class="fas fa-vial"></i>
            </div>
            <div class="selection-content">
                <label for="disease-sample-select" class="selection-label">选择分析样本</label>
                <select class="form-control custom-select" id="disease-sample-select">
                    <option value="">请选择已完成分析的样本...</option>
                </select>
                <small class="form-text">请选择已完成16S测序分析的样本进行疾病风险预测</small>
            </div>
        </div>
    </div>

    <!-- 预测控制区域 -->
    <div class="prediction-control-section">
        <button class="btn btn-predict" id="predict-disease-btn" disabled>
            <i class="fas fa-magic"></i>
            <span class="btn-text">开始预测</span>
        </button>
        <div class="prediction-info">
            <i class="fas fa-info-circle"></i>
            <span>预测将分析15种常见疾病的风险概率</span>
        </div>
    </div>

    <!-- 预测结果展示 -->
    <div id="disease-prediction-results" class="results-section" style="display: none;">
        <div class="results-header">
            <h4 class="results-title">
                <i class="fas fa-chart-line"></i>
                预测结果分析
            </h4>
            <div class="results-summary">
                <span class="summary-item">
                    <i class="fas fa-disease"></i>
                    分析疾病: <strong id="disease-count">15种</strong>
                </span>
                <span class="summary-item">
                    <i class="fas fa-clock"></i>
                    预测时间: <strong id="prediction-time"></strong>
                </span>
            </div>
        </div>

        <div class="results-grid">
            <!-- 疾病风险概率表格 -->
            <div class="results-card probability-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-list-alt"></i>
                        疾病风险预测概率
                    </h5>
                    <div class="card-actions">
                        <button class="btn btn-sm btn-outline-primary" onclick="exportResults()">
                            <i class="fas fa-download"></i>
                            导出
                        </button>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-container">
                        <table class="table custom-table">
                            <thead>
                                <tr>
                                    <th class="disease-col">疾病类型</th>
                                    <th class="risk-col">风险概率</th>
                                    <th class="level-col">风险等级</th>
                                </tr>
                            </thead>
                            <tbody id="disease-probabilities">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- 风险分布图表 -->
            <div class="results-card chart-card">
                <div class="card-header">
                    <h5 class="card-title">
                        <i class="fas fa-chart-bar"></i>
                        风险等级分布
                    </h5>
                    <div class="chart-legend">
                        <span class="legend-item">
                            <span class="legend-color low-risk"></span>
                            低风险
                        </span>
                        <span class="legend-item">
                            <span class="legend-color medium-risk"></span>
                            中风险
                        </span>
                        <span class="legend-item">
                            <span class="legend-color high-risk"></span>
                            高风险
                        </span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart-container">
                        <canvas id="disease-risk-chart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- 风险分析摘要 -->
        <div class="risk-summary-section">
            <div class="summary-cards">
                <div class="summary-card low-risk-card">
                    <div class="summary-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="summary-content">
                        <h6>低风险疾病</h6>
                        <span class="summary-count" id="low-risk-count">0</span>
                    </div>
                </div>
                <div class="summary-card medium-risk-card">
                    <div class="summary-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="summary-content">
                        <h6>中风险疾病</h6>
                        <span class="summary-count" id="medium-risk-count">0</span>
                    </div>
                </div>
                <div class="summary-card high-risk-card">
                    <div class="summary-icon">
                        <i class="fas fa-exclamation-circle"></i>
                    </div>
                    <div class="summary-content">
                        <h6>高风险疾病</h6>
                        <span class="summary-count" id="high-risk-count">0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 预测结果模板 -->
<script id="disease-probability-template" type="text/template">
    <tr class="disease-row {risk_class}">
        <td class="disease-name">
            <i class="fas fa-disease"></i>
            {disease_name}
        </td>
        <td class="risk-probability">
            <div class="progress-container">
                <div class="progress-bar {risk_class}" style="width: {probability}%"></div>
                <span class="progress-text">{probability}%</span>
            </div>
        </td>
        <td class="risk-level">
            <span class="risk-badge {risk_class}">{risk_level}</span>
        </td>
    </tr>
</script>

<!-- 常见病预测相关的JavaScript -->
<script>
$(document).ready(function() {
    // 加载可用样本
    function loadAvailableSamples() {
        $.get('/get_available_samples/', function(response) {
            const select = $('#disease-sample-select');
            select.empty().append('<option value="">请选择已完成分析的样本...</option>');
            
            response.samples.forEach(function(sample) {
                if (sample.status === '已完成分析') {
                    select.append(`<option value="${sample.name}">${sample.name}</option>`);
                }
            });
        });
    }

    // 初始加载样本
    loadAvailableSamples();

    // 样本选择变化时启用/禁用预测按钮
    $('#disease-sample-select').change(function() {
        const hasSelection = $(this).val();
        $('#predict-disease-btn').prop('disabled', !hasSelection);
        
        if (hasSelection) {
            $(this).addClass('selected');
        } else {
            $(this).removeClass('selected');
        }
    });

    // 预测按钮点击事件
    $('#predict-disease-btn').click(function() {
        const sampleName = $('#disease-sample-select').val();
        if (!sampleName) return;

        // 显示加载状态
        const btn = $(this);
        btn.prop('disabled', true)
           .html('<i class="fas fa-spinner fa-spin"></i><span class="btn-text">预测中...</span>');

        // 发送预测请求
        $.post('/predict_diseases/', {
            sample_name: sampleName,
            csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
        })
        .done(function(response) {
            if (response.success) {
                displayDiseaseResults(response.predictions);
                updatePredictionTime();
            } else {
                showError('预测失败: ' + response.error);
            }
        })
        .fail(function() {
            showError('预测请求失败，请稍后重试');
        })
        .always(function() {
            // 恢复按钮状态
            btn.prop('disabled', false)
               .html('<i class="fas fa-magic"></i><span class="btn-text">开始预测</span>');
        });
    });

    // 显示预测结果
    function displayDiseaseResults(predictions) {
        const resultsDiv = $('#disease-prediction-results');
        const tbody = $('#disease-probabilities');
        const template = $('#disease-probability-template').html();
        
        tbody.empty();
        
        let lowRiskCount = 0, mediumRiskCount = 0, highRiskCount = 0;
        
        // 检查预测结果是否为空
        if (!predictions || Object.keys(predictions).length === 0) {
            showError('未获得有效的预测结果');
            return;
        }
        
        // 按概率降序排序
        const sortedPredictions = Object.entries(predictions).sort((a, b) => b[1] - a[1]);
        
        // 添加每个疾病的预测结果
        sortedPredictions.forEach(([diseaseName, probability]) => {
            const probabilityPercent = (probability * 100).toFixed(1);
            const riskLevel = getRiskLevel(probability);
            const riskClass = getRiskClass(probability);
            
            // 统计风险等级数量
            if (riskLevel === '低风险') lowRiskCount++;
            else if (riskLevel === '中风险') mediumRiskCount++;
            else highRiskCount++;
            
            const row = template
                .replace(/{disease_name}/g, diseaseName)
                .replace(/{probability}/g, probabilityPercent)
                .replace(/{risk_level}/g, riskLevel)
                .replace(/{risk_class}/g, riskClass);
            tbody.append(row);
        });

        // 更新风险统计
        $('#low-risk-count').text(lowRiskCount);
        $('#medium-risk-count').text(mediumRiskCount);
        $('#high-risk-count').text(highRiskCount);

        // 更新疾病数量
        $('#disease-count').text(`${Object.keys(predictions).length}种`);

        // 更新预测时间
        updatePredictionTime();

        // 显示结果区域
        resultsDiv.fadeIn(500);

        // 更新图表
        updateDiseaseChart(predictions);
        
        // 添加滚动优化
        setTimeout(() => {
            optimizeProgressBars();
            setupScrollOptimization();
        }, 600);
        
        // 平滑滚动到结果区域
        setTimeout(() => {
            const resultsOffset = resultsDiv.offset().top - 100;
            $('html, body').animate({
                scrollTop: resultsOffset
            }, 800, 'swing');
        }, 600);
        
        // 显示成功消息
        showSuccess(`成功预测了 ${Object.keys(predictions).length} 种疾病的风险概率`);
    }
    
    // 优化进度条显示
    function optimizeProgressBars() {
        $('.progress-bar').each(function() {
            const $this = $(this);
            const width = $this.css('width');
            // 强制重绘
            $this.hide().show();
            // 重新设置宽度以确保正确显示
            setTimeout(() => {
                $this.css('width', width);
            }, 10);
        });
    }
    
    // 设置滚动优化
    function setupScrollOptimization() {
        const tableContainer = $('.table-container');
        let scrollTimeout;
        
        tableContainer.on('scroll', function() {
            // 防抖优化
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                // 滚动结束后重新优化进度条
                optimizeProgressBars();
            }, 100);
        });
        
        // 监听窗口大小变化
        $(window).on('resize', function() {
            setTimeout(optimizeProgressBars, 200);
        });
    }

    // 获取风险等级
    function getRiskLevel(probability) {
        if (probability < 0.3) return '低风险';
        if (probability < 0.7) return '中风险';
        return '高风险';
    }

    // 获取风险等级CSS类
    function getRiskClass(probability) {
        if (probability < 0.3) return 'low-risk';
        if (probability < 0.7) return 'medium-risk';
        return 'high-risk';
    }

    // 更新预测时间
    function updatePredictionTime() {
        const now = new Date();
        const timeString = now.toLocaleString('zh-CN');
        $('#prediction-time').text(timeString);
    }

    // 显示错误信息
    function showError(message) {
        const errorDiv = $('<div class="alert alert-danger alert-dismissible fade show" role="alert">' +
            '<i class="fas fa-exclamation-triangle"></i> ' + message +
            '<button type="button" class="btn-close" data-bs-dismiss="alert">&times;</button>' +
            '</div>');
        
        $('.disease-prediction-container').prepend(errorDiv);
        
        setTimeout(() => {
            errorDiv.fadeOut(500, function() {
                $(this).remove();
            });
        }, 5000);
    }

    // 显示成功信息
    function showSuccess(message) {
        const successDiv = $('<div class="alert alert-success alert-dismissible fade show" role="alert">' +
            '<i class="fas fa-check-circle"></i> ' + message +
            '<button type="button" class="btn-close" data-bs-dismiss="alert">&times;</button>' +
            '</div>');
        
        $('.disease-prediction-container').prepend(successDiv);
        
        setTimeout(() => {
            successDiv.fadeOut(500, function() {
                $(this).remove();
            });
        }, 3000);
    }

    // 更新风险分布图表
    function updateDiseaseChart(predictions) {
        const ctx = document.getElementById('disease-risk-chart').getContext('2d');
        
        // 销毁现有图表
        if (window.diseaseChart) {
            window.diseaseChart.destroy();
        }

        // 准备数据 - 显示所有疾病，按风险概率降序排序
        const sortedEntries = Object.entries(predictions).sort((a, b) => b[1] - a[1]);
        const labels = sortedEntries.map(([disease]) => disease);
        const data = sortedEntries.map(([, probability]) => probability * 100);
        const colors = sortedEntries.map(([, probability]) => {
            if (probability < 0.3) return 'rgba(76, 175, 80, 0.7)';      // 绿色 - 低风险
            if (probability < 0.7) return 'rgba(255, 152, 0, 0.7)';      // 橙色 - 中风险
            return 'rgba(244, 67, 54, 0.7)';                             // 红色 - 高风险
        });

        // 创建新图表
        window.diseaseChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: '风险概率 (%)',
                    data: data,
                    backgroundColor: colors,
                    borderColor: colors.map(c => c.replace('0.7', '1')),
                    borderWidth: 2,
                    borderRadius: 8,
                    borderSkipped: false,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        borderColor: 'rgba(255, 255, 255, 0.2)',
                        borderWidth: 1,
                        cornerRadius: 8,
                        displayColors: false,
                        callbacks: {
                            label: function(context) {
                                return `风险概率: ${context.parsed.y.toFixed(1)}%`;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.1)',
                            drawBorder: false
                        },
                        ticks: {
                            color: '#666',
                            font: {
                                size: 12
                            }
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: '#666',
                            font: {
                                size: 10
                            },
                            maxRotation: 45,
                            minRotation: 45,
                            callback: function(value, index) {
                                // 获取原始标签
                                const label = this.getLabelForValue(value);
                                // 如果疾病名称太长，进行智能截断
                                if (label.length > 8) {
                                    // 保留重要的疾病关键词
                                    if (label.includes('型糖尿病')) return '2型糖尿病';
                                    if (label.includes('帕金森')) return '帕金森病';
                                    if (label.includes('阿尔兹海默')) return '阿尔兹海默';
                                    if (label.includes('脂肪肝')) return '脂肪肝';
                                    if (label.includes('肠易激')) return '肠易激';
                                    if (label.includes('自身免疫')) return '自身免疫';
                                    if (label.includes('认知功能')) return '认知障碍';
                                    if (label.includes('结肠性肿瘤')) return '结肠肿瘤';
                                    if (label.includes('炎症性肠病')) return '炎症肠病';
                                    return label.substring(0, 6) + '...';
                                }
                                return label;
                            }
                        }
                    }
                },
                animation: {
                    duration: 1000,
                    easing: 'easeOutQuart'
                }
            }
        });
    }

    // 导出结果
    window.exportResults = function() {
        const table = document.getElementById('disease-probabilities');
        const chart = window.diseaseChart;
        
        if (!table || !chart) {
            showError('暂无可导出的数据');
            return;
        }
        
        // 显示导出选项对话框
        showExportDialog();
    };
    
    // 显示导出选项对话框
    function showExportDialog() {
        const dialog = $(`
            <div class="export-dialog-overlay">
                <div class="export-dialog">
                    <h5 class="export-dialog-title">
                        <i class="fas fa-download"></i>
                        选择导出内容
                    </h5>
                    <div class="export-options">
                        <label class="export-option">
                            <input type="checkbox" id="export-table" checked>
                            <span class="option-text">疾病风险预测数据表格 (CSV)</span>
                        </label>
                        <label class="export-option">
                            <input type="checkbox" id="export-chart" checked>
                            <span class="option-text">风险等级分布图表 (PNG)</span>
                        </label>
                    </div>
                    <div class="export-actions">
                        <button class="btn btn-secondary" onclick="closeExportDialog()">取消</button>
                        <button class="btn btn-primary" onclick="performExport()">
                            <i class="fas fa-download"></i>
                            开始导出
                        </button>
                    </div>
                </div>
            </div>
        `);
        
        $('body').append(dialog);
        dialog.fadeIn(300);
    }
    
    // 关闭导出对话框
    window.closeExportDialog = function() {
        $('.export-dialog-overlay').fadeOut(300, function() {
            $(this).remove();
        });
    };
    
    // 执行导出
    window.performExport = function() {
        const exportTable = $('#export-table').is(':checked');
        const exportChart = $('#export-chart').is(':checked');
        
        if (!exportTable && !exportChart) {
            showError('请至少选择一项导出内容');
            return;
        }
        
        // 导出表格数据
        if (exportTable) {
            exportTableData();
        }
        
        // 导出图表
        if (exportChart) {
            exportChartImage();
        }
        
        closeExportDialog();
        showSuccess('导出完成！');
    };
    
    // 导出表格数据
    function exportTableData() {
        const table = document.getElementById('disease-probabilities');
        let csv = '疾病类型,风险概率(%),风险等级\n';
        
        $(table).find('tr').each(function() {
            const diseaseName = $(this).find('.disease-name').text().trim();
            const probability = $(this).find('.progress-text').text();
            const riskLevel = $(this).find('.risk-badge').text();
            
            if (diseaseName && probability && riskLevel) {
                csv += `"${diseaseName}","${probability}","${riskLevel}"\n`;
            }
        });
        
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        link.setAttribute('href', url);
        
        const now = new Date();
        const timestamp = now.toISOString().slice(0, 19).replace(/[:-]/g, '');
        link.setAttribute('download', `疾病风险预测数据_${timestamp}.csv`);
        
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
    }
    
    // 导出图表图像
    function exportChartImage() {
        const chart = window.diseaseChart;
        const canvas = chart.canvas;
        
        // 创建一个新的canvas来绘制白色背景
        const newCanvas = document.createElement('canvas');
        const newCtx = newCanvas.getContext('2d');
        
        newCanvas.width = canvas.width;
        newCanvas.height = canvas.height;
        
        // 绘制白色背景
        newCtx.fillStyle = 'white';
        newCtx.fillRect(0, 0, newCanvas.width, newCanvas.height);
        
        // 绘制原图表
        newCtx.drawImage(canvas, 0, 0);
        
        // 导出图像
        newCanvas.toBlob(function(blob) {
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            
            const now = new Date();
            const timestamp = now.toISOString().slice(0, 19).replace(/[:-]/g, '');
            link.setAttribute('download', `风险等级分布图_${timestamp}.png`);
            
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }, 'image/png');
    }
});
</script>

<!-- 自定义样式 -->
<style>
.disease-prediction-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

/* 模块标题区域 */
.module-header {
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 30px;
    padding: 25px;
    background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
    border-radius: 20px;
    color: #2d3748;
    box-shadow: 0 10px 30px rgba(224, 234, 252, 0.6);
}

.header-icon {
    font-size: 3rem;
    opacity: 0.9;
    color: #2176ff;
}

.module-title {
    font-size: 2rem;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: #2d3748;
}

.module-subtitle {
    font-size: 1.1rem;
    opacity: 0.9;
    margin: 0;
    color: #4a5568;
}

/* 样本选择区域 */
.sample-selection-section {
    margin-bottom: 30px;
}

.selection-card {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 25px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.card-icon {
    font-size: 2rem;
    color: #2176ff;
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(33, 118, 255, 0.1);
    border-radius: 15px;
}

.selection-content {
    flex: 1;
}

.selection-label {
    font-size: 1.1rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 10px;
    display: block;
}

.custom-select {
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    padding: 12px 15px;
    font-size: 1rem;
    transition: all 0.3s ease;
    background: #f8fafc;
}

.custom-select:focus {
    border-color: #2176ff;
    box-shadow: 0 0 0 3px rgba(33, 118, 255, 0.12);
    background: white;
}

.custom-select.selected {
    border-color: #2176ff;
    background: white;
}

.form-text {
    color: #718096;
    font-size: 0.9rem;
    margin-top: 8px;
}

/* 预测控制区域 */
.prediction-control-section {
    text-align: center;
    margin-bottom: 40px;
}

.btn-predict {
    background: linear-gradient(120deg, #e0eafc 0%, #cfdef3 100%);
    border: none;
    color: #2d3748;
    padding: 15px 40px;
    font-size: 1.1rem;
    font-weight: 600;
    border-radius: 50px;
    box-shadow: 0 8px 25px rgba(224, 234, 252, 0.8);
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 12px;
}

.btn-predict:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 12px 35px rgba(224, 234, 252, 1);
}

.btn-predict:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

.prediction-info {
    margin-top: 15px;
    color: #718096;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

/* 结果展示区域 */
.results-section {
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.results-header {
    background: linear-gradient(120deg, #f3f8ff 0%, #e6f0ff 100%);
    padding: 25px 30px;
    border-bottom: 1px solid #dbeafe;
}

.results-title {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d3748;
    margin: 0 0 15px 0;
    display: flex;
    align-items: center;
    gap: 12px;
}

.results-summary {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 8px;
    color: #4a5568;
    font-size: 0.95rem;
}

.summary-item i { color: #2176ff; }

/* 结果网格 */
.results-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    padding: 30px;
}

.results-card {
    background: white;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid #e2e8f0;
    overflow: hidden;
}

.card-header {
    background: #f5faff;
    padding: 20px 25px;
    border-bottom: 1px solid #dbeafe;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-title {
    font-size: 1.2rem;
    font-weight: 600;
    color: #2d3748;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.card-actions .btn {
    padding: 6px 15px;
    font-size: 0.9rem;
    border-radius: 8px;
}

.card-body {
    padding: 25px;
}

/* 表格样式 */
.table-container {
    max-height: 400px;
    overflow-y: auto;
    /* 优化滚动性能 */
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    /* 添加硬件加速 */
    transform: translateZ(0);
    will-change: scroll-position;
    backface-visibility: hidden;
    /* 优化滚动条样式 */
    scrollbar-width: thin;
    scrollbar-color: #cbd5e0 #f7fafc;
}

/* 自定义滚动条样式 (WebKit浏览器) */
.table-container::-webkit-scrollbar {
    width: 8px;
}

.table-container::-webkit-scrollbar-track {
    background: #f7fafc;
    border-radius: 4px;
}

.table-container::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 4px;
    transition: background-color 0.2s ease;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
}

.custom-table {
    margin: 0;
    border-collapse: separate;
    border-spacing: 0;
    /* 添加表格渲染优化 */
    table-layout: fixed;
    width: 100%;
}

.custom-table th {
    background: #f5faff;
    color: #2d3748;
    font-weight: 600;
    padding: 15px 12px;
    border-bottom: 2px solid #dbeafe;
    position: sticky;
    top: 0;
    z-index: 10;
    /* 优化粘性定位的渲染 */
    transform: translateZ(0);
    backface-visibility: hidden;
}

.custom-table td {
    padding: 15px 12px;
    border-bottom: 1px solid #f1f5f9;
    vertical-align: middle;
    /* 优化单元格渲染 */
    transform: translateZ(0);
    backface-visibility: hidden;
}

.disease-col {
    width: 35%;
    min-width: 150px;
}

.risk-col {
    width: 40%;
    min-width: 200px;
}

.level-col {
    width: 25%;
    min-width: 100px;
    text-align: center;
}

.disease-name {
    display: flex;
    align-items: center;
    gap: 10px;
    font-weight: 500;
    color: #2d3748;
}

.disease-name i { 
    color: #2176ff; 
    flex-shrink: 0;
}

/* 进度条样式 */
.progress-container {
    position: relative;
    background: #f1f5f9;
    border-radius: 12px;
    height: 28px;
    overflow: hidden;
    border: 1px solid #e2e8f0;
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    display: flex;
    align-items: center;
    /* 添加硬件加速和优化渲染 */
    transform: translateZ(0);
    will-change: auto;
    backface-visibility: hidden;
}

.progress-bar {
    height: 100%;
    border-radius: 11px; /* 稍微小一点确保不会溢出 */
    position: absolute;
    top: 0;
    left: 0;
    transition: width 1.2s ease-in-out;
    min-width: 30px; /* 确保即使很小的概率也能显示 */
    /* 添加硬件加速 */
    transform: translateZ(0);
    will-change: width;
    backface-visibility: hidden;
}

.progress-bar.low-risk {
    background: linear-gradient(90deg, #4caf50, #66bb6a);
    box-shadow: 0 2px 4px rgba(76, 175, 80, 0.3);
}

.progress-bar.medium-risk {
    background: linear-gradient(90deg, #ff9800, #ffb74d);
    box-shadow: 0 2px 4px rgba(255, 152, 0, 0.3);
}

.progress-bar.high-risk {
    background: linear-gradient(90deg, #f44336, #ef5350);
    box-shadow: 0 2px 4px rgba(244, 67, 54, 0.3);
}

.progress-text {
    color: #2d3748;
    font-size: 0.85rem;
    font-weight: 700;
    white-space: nowrap;
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 15;
    text-shadow: 0 1px 2px rgba(255, 255, 255, 0.9);
    /* 确保文字渲染清晰 */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    /* 防止文字模糊 */
    transform-style: preserve-3d;
    backface-visibility: hidden;
}

/* 风险等级标签 */
.risk-badge {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    white-space: nowrap;
    text-align: center;
    min-width: 70px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.risk-badge.low-risk {
    background: rgba(76, 175, 80, 0.1);
    color: #2e7d32;
    border: 1px solid rgba(76, 175, 80, 0.3);
}

.risk-badge.medium-risk {
    background: rgba(255, 152, 0, 0.1);
    color: #f57c00;
    border: 1px solid rgba(255, 152, 0, 0.3);
}

.risk-badge.high-risk {
    background: rgba(244, 67, 54, 0.1);
    color: #c62828;
    border: 1px solid rgba(244, 67, 54, 0.3);
}

/* 图表区域 */
.chart-container {
    height: 450px;
    position: relative;
}

.chart-legend {
    display: flex;
    gap: 15px;
    align-items: center;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.85rem;
    color: #2d3748;
}

.legend-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

.legend-color.low-risk {
    background: #4caf50;
}

.legend-color.medium-risk {
    background: #ff9800;
}

.legend-color.high-risk {
    background: #f44336;
}

/* 风险摘要区域 */
.risk-summary-section {
    padding: 30px;
    background: #f5faff;
    border-top: 1px solid #dbeafe;
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.summary-card {
    background: white;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid #dbeafe;
    transition: transform 0.3s ease;
}

.summary-card:hover {
    transform: translateY(-2px);
}

.summary-icon {
    font-size: 2rem;
    margin-bottom: 15px;
}

.low-risk-card .summary-icon {
    color: #4caf50;
}

.medium-risk-card .summary-icon {
    color: #ff9800;
}

.high-risk-card .summary-icon {
    color: #f44336;
}

.summary-content h6 {
    color: #2d3748;
    font-size: 0.9rem;
    margin-bottom: 8px;
    font-weight: 600;
}

.summary-count {
    font-size: 2rem;
    font-weight: 700;
    color: #2d3748;
}

/* 响应式设计 */
@media (max-width: 1024px) {
    .results-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .results-summary {
        flex-direction: column;
        gap: 15px;
    }
}

@media (max-width: 768px) {
    .disease-prediction-container {
        padding: 15px;
    }
    
    .module-header {
        flex-direction: column;
        text-align: center;
        padding: 20px;
    }
    
    .header-icon {
        font-size: 2.5rem;
    }
    
    .module-title {
        font-size: 1.5rem;
    }
    
    .selection-card {
        flex-direction: column;
        text-align: center;
        gap: 15px;
    }
    
    .summary-cards {
        grid-template-columns: 1fr;
    }
    
    .custom-table th,
    .custom-table td {
        padding: 10px 8px;
        font-size: 0.9rem;
    }
    
    .disease-name {
        flex-direction: column;
        gap: 5px;
        text-align: center;
    }
}

@media (max-width: 480px) {
    .table-container {
        overflow-x: auto;
    }
    
    .custom-table {
        min-width: 400px;
    }
    
    .disease-name {
        flex-direction: column;
        gap: 4px;
        text-align: center;
    }
    
    .progress-container {
        height: 20px;
    }
    
    .progress-text {
        font-size: 0.7rem;
    }
    
    .risk-badge {
        padding: 4px 8px;
        font-size: 0.65rem;
        min-width: 50px;
    }
}

/* 响应式设计 */
@media (max-width: 768px) {
    .disease-prediction-container {
        padding: 15px;
    }
    
    .results-grid {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .custom-table {
        font-size: 0.9rem;
    }
    
    .custom-table th,
    .custom-table td {
        padding: 10px 8px;
    }
    
    .disease-col {
        width: 30%;
        min-width: 120px;
    }
    
    .risk-col {
        width: 45%;
        min-width: 150px;
    }
    
    .level-col {
        width: 25%;
        min-width: 80px;
    }
    
    .progress-container {
        height: 24px;
        /* 移动端进度条优化 */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
    }
    
    .progress-bar {
        /* 移动端进度条优化 */
        transform: translateZ(0);
        -webkit-transform: translateZ(0);
        border-radius: 10px;
    }
    
    .progress-text {
        font-size: 0.75rem;
        font-weight: 700;
        /* 移动端文字优化 */
        -webkit-font-smoothing: antialiased;
        text-rendering: optimizeLegibility;
    }
    
    .risk-badge {
        padding: 6px 12px;
        font-size: 0.7rem;
        min-width: 60px;
    }
    
    .disease-name {
        gap: 8px;
        font-size: 0.9rem;
    }
    
    .disease-name i {
        font-size: 0.9rem;
    }
    
    /* 移动端滚动优化 */
    .table-container {
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
    }
}

/* 动画效果 */
@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.results-section {
    animation: fadeInUp 0.6s ease;
}

.disease-row {
    animation: fadeInUp 0.4s ease;
    transition: background-color 0.2s ease;
    /* 优化行的渲染性能 */
    transform: translateZ(0);
    backface-visibility: hidden;
}

.disease-row:hover {
    background-color: #f8fafc !important;
    /* 确保悬停时不影响子元素渲染 */
    transform: translateZ(0);
}

/* 滚动条样式 */
.table-container::-webkit-scrollbar {
    width: 6px;
}

.table-container::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb {
    background: #cbd5e0;
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: #a0aec0;
}

/* 导出对话框样式 */
.export-dialog-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.export-dialog {
    background: white;
    border-radius: 15px;
    padding: 30px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    min-width: 400px;
    max-width: 500px;
    animation: dialogSlideIn 0.3s ease;
}

.export-dialog-title {
    font-size: 1.3rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-bottom: 2px solid #e2e8f0;
    padding-bottom: 15px;
}

.export-options {
    margin-bottom: 25px;
}

.export-option {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 15px;
    margin-bottom: 10px;
    border: 2px solid #e2e8f0;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.export-option:hover {
    border-color: #2176ff;
    background: #f0f8ff;
}

.export-option input[type="checkbox"] {
    width: 18px;
    height: 18px;
    accent-color: #2176ff;
}

.option-text {
    font-size: 1rem;
    color: #2d3748;
    font-weight: 500;
}

.export-actions {
    display: flex;
    gap: 15px;
    justify-content: flex-end;
}

.export-actions .btn {
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 600;
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.export-actions .btn-secondary {
    background: #e2e8f0;
    color: #4a5568;
}

.export-actions .btn-secondary:hover {
    background: #cbd5e0;
}

.export-actions .btn-primary {
    background: linear-gradient(135deg, #2176ff, #1e40af);
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
}

.export-actions .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(33, 118, 255, 0.4);
}

@keyframes dialogSlideIn {
    from {
        opacity: 0;
        transform: translateY(-30px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}
</style> 